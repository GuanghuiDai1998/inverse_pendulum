#ä¸€é˜¶å€’ç«‹æ‘†çš„PIDæ§åˆ¶å’ŒLQRæ§åˆ¶
##å»ºæ¨¡ä¸åˆ†æ
ä¸€ä¸ªå¯ä»¥æ´»åŠ¨çš„å°è½¦ä¸Šç«‹ç€ä¸€æ ¹ä¸ç¨³å®šéšæ—¶ä¼šå€’ä¸‹çš„æ†ã€‚å°è½¦çš„è½®å­ç”±ç”µæœºæ§åˆ¶ï¼Œå¯ä»¥æ§åˆ¶å°è½¦ç”µæœºçš„è½¬åŠ¨åŠ›çŸ©Mã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥è·å–å°è½¦è½®å­è½¬åŠ¨çš„åœˆæ•°Nï¼ˆå¯ä»¥ç²¾ç¡®åˆ°å°æ•°ï¼‰å’Œæ†ç›¸å¯¹äºå‚ç›´ä½ç½®çš„å€¾è§’Î±.  
<div align=center>
![](https://ws1.sinaimg.cn/large/006tNbRwgy1fwuyvylzo3j3069057td0.jpg)
<div align=left>
ä¸è€ƒè™‘è½¦è½®æ‰“æ»‘, å°è½¦æ‰€å—åŠ›å¤§å°ç­‰äºç”µæœºåŠ›çŸ©ä¹˜è½¦è½®åŠå¾„, å°è½¦ä½ç½®å¯ä»¥ä»è½¬åŠ¨åœˆæ•°è®¡ç®—å‡º, å°è½¦å¯ç®€åŒ–ä¸ºæœ€ç»å…¸çš„ä¸€é˜¶å€’ç«‹æ‘†:  
<div align=center>
![](https://ws1.sinaimg.cn/large/006tNbRwgy1fwuyusgsoxj308x08jwer.jpg)
<div align=left>

åå­—	| æ„ä¹‰			| ä¸¾ä¾‹å€¼|
------|--------------------|------|
M		|å°è½¦è´¨é‡				|0.5 kg
m		|æ‘†çš„è´¨é‡				|0.2 kg
l		|æ‘†çš„é‡å¿ƒåˆ°å…³èŠ‚çš„è·ç¦»	|0.3 m
I		|æ‘†çš„è½¬åŠ¨æƒ¯é‡			|0.018 kg.m^2
b		|é˜»å°¼ç³»æ•°				|0.1 N/m/sec
F		|ä½œç”¨åœ¨å°è½¦çš„åŠ›	
x		|å°è½¦çš„ä½ç½®
$$\theta$$| æ‘†çš„è§’åº¦
###å—åŠ›åˆ†æä¸æ–¹ç¨‹å»ºç«‹
<div align=center>
![](https://ws1.sinaimg.cn/large/006tNbRwgy1fwuzwulqu7j308108hjrl.jpg)
<div align=left>

å¯¹å°è½¦æ°´å¹³æ–¹å‘:  
$$M\ddot x+b\dot x + N =F$$
å¯¹æ‘†æ°´å¹³æ–¹å‘:  

$$H=M\frac{d^2}{dt}(x+lsin\theta)$$  

å³:  
$$H=m\ddot x+ml\ddot \theta cos\ddot \theta - ml\dot \theta^2 sin \theta$$  

å¯¹æ‘†å‚ç›´æ–¹å‘:  
$$P=mg+ m\frac{d^2}{dt}(lcos\theta)$$

å³:  
$$P=mg - ml\ddot \theta sin\ddot \theta - ml\dot \theta^2 cos \theta$$  

å…³èŠ‚åŠ›çŸ©:

$$-Plsin\theta - Nlcos\theta = I\theta^2$$  

ä»¤$$\phi = \pi +\theta$$  

åœ¨å·¥ä½œç‚¹$$\theta \approx 0 $$è¿›è¡Œçº¿æ€§åŒ–:  $$sin\theta = 0 \space , cos\theta=1 $$
ç»è¿‡ä¸€é¡¿æ“ä½œåŒ–ç®€ä¹‹åèƒ½å¾—åˆ°:

$$
(I+ml^2)\ddot \phi - mgl\phi = ml\ddot x \\
(M+m)\ddot x+b\dot x-ml\ddot \phi = F =u
$$
###ä¼ é€’å‡½æ•°è¡¨ç¤º
è¿›è¡Œæ‹‰æ™®æ‹‰æ–¯å˜æ¢å¾—åˆ°:  

$$
(I+ml^2)\Phi(s)s^2 - mgl\Phi(s) = mlX(s)s^2 \\
(M+m)X(s)s^2+bX(s)s-ml\Phi(s)s^2 = U(s)
$$

ä¸€é¡¿æ“ä½œå¾—åˆ°æ‘†çš„è§’åº¦çš„ä¼ é€’å‡½æ•°:

$$
P_{pend}(s) = \frac{\Phi(s)}{U(s)} = \frac{mls}{qs^3+b(I+ml^2)s^2-(M+m)mgls-bmgl}
$$

å°è½¦ä½ç½®çš„ä¼ é€’å‡½æ•°:
$$
P_{cart}(s) = \frac{X(s)}{U(s)} = \frac{(I+ml^2)s^2-mgl}{qs^4+b(I+ml^2)s^3-(M+m)mgls^2-bmgls}
$$

å…¶ä¸­$$q$$ä¸º:
$$
q = [(M+m)(I+ml^2)-(ml)^2]
$$

Matlabä»£ç :  

```  
%Modeling
%%Transfer Function
mCart = 0.5;
mPend = 0.2;
b = 0.1;
I = 0.018;
g = 9.8;
L = 0.3;
q = (mCart+mPend)*(I+mPend*L^2)-(mPend*L)^2;
s = tf('s');

P_cart = (((I+mPend*L^2)/q)*s^2 - (mPend*g*L/q))/(s^4 + (b*(I + mPend*L^2))*s^3/q - ((mCart + mPend)*mPend*g*L)*s^2/q - b*mPend*g*L*s/q);
P_pend = (mPend*L*s/q)/(s^3 + (b*(I + mPend*L^2))*s^2/q - ((mCart + mPend)*mPend*g*L)*s/q - b*mPend*g*L/q);

sys_tf = [P_cart ; P_pend]

inputs = {'u'};
outputs = {'x'; 'phi'};

set(sys_tf,'InputName',inputs)
set(sys_tf,'OutputName',outputs)

```  
è¾“å‡º

```  
sys_tf =
 
  From input to output...
                       1.68e-05 s^2 - 0.0002743
   1:  ---------------------------------------------------------
       1.008e-05 s^4 + 1.68e-06 s^3 - 0.000192 s^2 - 2.743e-05 s
 
                            2.799e-05 s
   2:  -----------------------------------------------------
       1.008e-05 s^3 + 1.68e-06 s^2 - 0.000192 s - 2.743e-05
 
Continuous-time transfer function.


```  
###çŠ¶æ€ç©ºé—´è¡¨ç¤º

$$
\dot x = Ax+Bu \\
y = Cx + Du
$$

å…¶ä¸­:

$$
A = 
 \left[
 \begin{matrix}
   0 & 1 & 0 & 0 \\
   0 & -\frac{(I+ml^2)b}{p} & \frac{m^2gl^2}{p} & 0 \\
   0 & 0 & 0 & 1\\
   0 & \frac{-mlb}{p} & \frac{mgl(M+m)}{p} &0
  \end{matrix}
  \right]
\\
$$
$$
B =
 \left[
 \begin{matrix}
   0\\
   \frac{I+ml^2}{p}\\
   0\\
   \frac{ml}{p}
  \end{matrix}
  \right]
$$
$$
C = 
 \left[
 \begin{matrix}
   1 & 0 & 0 & 0\\
   0 & 0 & 1 & 0
  \end{matrix}
  \right]
$$
$$
D =
 \left[
 \begin{matrix}
   0\\
   0
  \end{matrix}
  \right]
$$
$$
x =
 \left[
 \begin{matrix}
   x\\
   \dot x\\
   \phi\\
   \dot \phi
  \end{matrix}
  \right]
$$
$$
p = I(M+m)+Mml^2
$$  

Matlabä»£ç :

```
p = I*(mCart+mPend)+mCart*mPend*L^2;

A = [0      1              0           0;
     0 -(I+mPend*L^2)*b/p  (mPend^2*g*L^2)/p   0;
     0      0              0           1;
     0 -(mPend*L*b)/p       mPend*g*L*(mCart+mPend)/p  0];
B = [     0;
     (I+mPend*L^2)/p;
          0;
        mPend*L/p];
C = [1 0 0 0;
     0 0 1 0];
D = [0;
     0];

states = {'x' 'x_dot' 'phi' 'phi_dot'};
inputs = {'u'};
outputs = {'x'; 'phi'};

sys_ss = ss(A,B,C,D,'statename',states,'inputname',inputs,'outputname',outputs)

```  
è¾“å‡º:  
 
```  
p = I*(mCart+mPend)+mCart*mPend*L^2;

A = [0      1              0           0;
     0 -(I+mPend*L^2)*b/p  (mPend^2*g*L^2)/p   0;
     0      0              0           1;
     0 -(mPend*L*b)/p       mPend*g*L*(mCart+mPend)/p  0];
B = [     0;
     (I+mPend*L^2)/p;
          0;
        mPend*L/p];
C = [1 0 0 0;
     0 0 1 0];
D = [0;
     0];

states = {'x' 'x_dot' 'phi' 'phi_dot'};
inputs = {'u'};
outputs = {'x'; 'phi'};

sys_ss = ss(A,B,C,D,'statename',states,'inputname',inputs,'outputname',outputs)

```
###åˆ†æ
####æç‚¹
ç»è¿‡ç›®æµ‹åˆ†æğŸ™„, ç³»ç»Ÿåº”è¯¥æ˜¯ä¸ç¨³å®šçš„, æ±‚ä¸€ä¸‹æç‚¹

```
pole(sys_tf)
```
è¾“å‡º:

```
ans =

         0
    4.3538
   -4.3776
   -0.1428
```
å¯ä»¥çœ‹åˆ°æç‚¹æ²¡æœ‰éƒ½åœ¨å¤å¹³é¢çš„å·¦è¾¹é¢(left-half plane (LHP)), ç³»ç»Ÿä¸ç¨³å®š. 
 
####å¼€ç¯æ‰°åŠ¨å“åº”
```
t=0:0.01:1;
impulse(sys_ss,t)
```
![](https://ws3.sinaimg.cn/large/006tNbRwgy1fwv6edwatxj30v40nc3ze.jpg)

####å¼€ç¯é˜¶è·ƒå“åº”
```
t = 0:0.05:1;
u = ones(size(t));
[y,t] = lsim(sys_tf,u,t);
figure
plot(t,y)
title('Open-Loop Step Response')
axis([0 3 0 50])
legend('x','phi')
```
![](https://ws4.sinaimg.cn/large/006tNbRwgy1fwv6k9olntj30v40ncjs4.jpg)

###ä½¿ç”¨Simscape Multibodyå»ºç«‹éçº¿æ€§æ¨¡å‹å¹¶ä»¿çœŸ
ä¸€å…±æœ‰ä¸¤ç§æ¨¡å‹:  
1.è¾“å‡ºæ˜¯å°è½¦ä½ç½®å’Œè§’åº¦, ç”¨äºPIDæ§åˆ¶å’ŒLQRæ§åˆ¶ä»¿çœŸ(observer based)
![](https://ws2.sinaimg.cn/large/006tNbRwgy1fwv6rcxn5tj31kw0sxn2m.jpg)
2.è¾“å‡ºæ˜¯å°è½¦ä½ç½®, å°è½¦é€Ÿåº¦, è§’åº¦, è§’åŠ é€Ÿåº¦, ç”¨ä½œfull stateçš„LQRæ§åˆ¶ä»¿çœŸ
![](https://ws1.sinaimg.cn/large/006tNbRwgy1fwv6z40stjj31kw0t1q8m.jpg)

å¼€ç¯æ‰°åŠ¨å“åº”çš„ä»¿çœŸ:
![](https://ws1.sinaimg.cn/large/006tNbRwgy1fwv74mqzzsj31kw0ud77r.jpg)
å› ä¸ºæ²¡æœ‰åœ¨å·¥ä½œç‚¹çº¿æ€§åŒ–, ä»¿çœŸç»“æœå’Œå®é™…æ›´ç›¸ä¼¼,æ‘†(è“è‰²çº¿)ä¸€ç›´å¾€ä¸€ä¸ªæ–¹å‘è½¬åŠ¨,é€Ÿåº¦èµ·ä¼è¾ƒå¤§, å°è½¦ä¹Ÿä¸€ç›´å¾€ä¸€ä¸ªæ–¹å‘è¿åŠ¨.
![](https://ws4.sinaimg.cn/large/006tNbRwgy1fwv945shg7g30i00aiamf.gif)
##PIDæ§åˆ¶
###è§’åº¦æ§åˆ¶
å¾ˆç®€å•PIDæ€¼ä¸Šå», ç„å­¦è°ƒå‚, æµ‹è¯•æ‰°åŠ¨å“åº”:

```
Kp = 100;
Ki = 1;
Kd = 30;
C = pid(Kp,Ki,Kd);
T1 = feedback(P_pend,C);

t=0:0.01:4;
impulse(T1,t)
```
![](https://ws4.sinaimg.cn/large/006tNbRwgy1fwv8ej9j1sj30v40ncmxw.jpg)
æŒºå¥½çš„, ä½†æ˜¯è¿™æ—¶å€™çš„å°è½¦...

```
T2 = feedback(1,P_pend*C)*P_cart;
t = 0:0.01:5;
impulse(T2, t);
```
![](https://ws1.sinaimg.cn/large/006tNbRwgy1fwv8h40q3vj30v40ncjs2.jpg)
ç»è¿‡ä¸€é˜µå“†å—¦ä¹‹åä¸€ç›´åŒ€é€Ÿè¿åŠ¨, è¿™ä¸ªæ—¶å€™æ‘†çš„æ‘†ä¹Ÿå’Œå°è½¦ä¸€èµ·ä½œåŒ€é€Ÿç›´çº¿è¿åŠ¨.
åœ¨Simscape ä»¿çœŸä¸‹ä¹Ÿæ˜¯å¦‚æ­¤:
![](https://ws4.sinaimg.cn/large/006tNbRwgy1fwv8qx2brzj31kw0t077s.jpg)
![](https://ws4.sinaimg.cn/large/006tNbRwgy1fxk2xo8tcaj30v40m0q44.jpg)
![](https://ws2.sinaimg.cn/large/006tNbRwgy1fwvz4offl1g30i00aiq4p.gif)
###ä½ç½®æ§åˆ¶
ä¸€ä¸ªå¾ˆæœ´ç´ çš„æƒ³æ³•, åœ¨å¹³è¡¡å°è½¦æ§åˆ¶ä¸­éå¸¸å¸¸è§, ä½¿ç”¨ä¸¤ä¸ªé—­ç¯:  

* ä¿æŒæ†çš„è§’åº¦, è¾“å…¥ä¸ºæ†çš„è§’åº¦è¯¯å·®, è¾“å‡ºä¸ºåŠ›çš„å¤§å° 
* ä¿æŒæ†çš„è§’åº¦, è¾“å…¥ä¸ºå°è½¦çš„ä½ç½®è¯¯å·®, è¾“å‡ºä¸ºæ†çš„å€¾æ–œè§’åº¦

![](https://ws4.sinaimg.cn/large/006tNbRwgy1fxk92ws4bsj31mx0u0djm.jpg)
![](https://ws2.sinaimg.cn/large/006tNbRwgy1fxk95dcv5jj31k70u0q6m.jpg)

æ§åˆ¶æ•ˆæœå¾ˆå·®...
##LQRæ§åˆ¶
å¯¹äºè¿™ç§MIMOçš„ç³»ç»Ÿ, å½“ç„¶è¦ç”¨ç°ä»£ä¸€ç‚¹çš„æ§åˆ¶æ–¹å¼å•¦
###å…¨çŠ¶æ€åé¦ˆ(Full state feedback)
å…ˆä¸è€ƒè™‘è§‚æµ‹å™¨, å¦‚æœå¯ä»¥å¾—åˆ°å°è½¦å’Œæ‘†çš„æ‰€æœ‰çŠ¶æ€, æˆ‘ä»¬ä½¿ç”¨å…¨çŠ¶æ€åé¦ˆæ§åˆ¶
![](https://ws1.sinaimg.cn/large/006tNbRwgy1fxk9m22mvnj30bu06st90.jpg)
![](https://ws3.sinaimg.cn/large/006tNbRwgy1fxkb4ozt10j31n00u078f.jpg)
é€šè¿‡è®¾å®šKçŸ©é˜µçš„å€¼, æˆ‘ä»¬å¯ä»¥æŠŠç³»ç»Ÿçš„æç‚¹æ”¾åˆ°ä»»ä½•åœ°æ–¹.

éšä¾¿æ”¾ç½®æç‚¹(åœ¨å·¦åŠé¢)

```
p1 = -10 + 10i;
p2 = -10 - 10i;
p3 = -15 + 10i;
p4 = -15 - 10i;

K = place(A,B,[p1 p2 p3 p4]);

Ac = (A-B*K);
Bc = B;
Cc = C;
Dc = D;

states = {'x' 'x_dot' 'phi' 'phi_dot'};
inputs = {'r'};
outputs = {'x'; 'phi'};

sys_cl = ss(Ac,Bc,Cc,Dc,'statename',states,'inputname',inputs,'outputname',outputs);

t = 0:0.01:10;
r =0.2*ones(size(t));

Cn = [1 0 0 0];
sys_ss = ss(A,B,Cn,0);
Nbar = rscale(sys_ss,K);

[y,t,x]=lsim(sys_cl,r,t);
[AX,H1,H2] = plotyy(t,y(:,1),t,y(:,2),'plot');
set(get(AX(1),'Ylabel'),'String','cart position (m)')
set(get(AX(2),'Ylabel'),'String','pendulum angle (radians)')
title('Step Response with LQR Control')

```
ç»“æœ:
![](https://ws2.sinaimg.cn/large/006tNbRwgy1fxka3uf689j30v40ncjs9.jpg)
Simscapeä»¿çœŸ:

![](https://ws2.sinaimg.cn/large/006tNbRwgy1fxkartwvo0j30v40m0q4b.jpg)
![](https://ws1.sinaimg.cn/large/006tNbRwgy1fxkabpb0npg30hz08eqvg.gif)

###ä½¿ç”¨LQRæ”¾ç½®æç‚¹
é€‰å®š$$R=1,Q(1,1) = 1,Q(3,3) = 100$$

```
Q = C'*C
Q(1,1) = 1;
Q(3,3) = 100


R = 1;
K = lqr(A,B,Q,R)



Ac = (A-B*K);
Bc = B;
Cc = C;
Dc = D;

states = {'x' 'x_dot' 'phi' 'phi_dot'};
inputs = {'r'};
outputs = {'x'; 'phi'};

sys_cl = ss(Ac,Bc,Cc,Dc,'statename',states,'inputname',inputs,'outputname',outputs);

t = 0:0.01:10;
r =0.2*ones(size(t));

Cn = [1 0 0 0];
sys_ss = ss(A,B,Cn,0);
Nbar = rscale(sys_ss,K);

[y,t,x]=lsim(sys_cl,r,t);
[AX,H1,H2] = plotyy(t,y(:,1),t,y(:,2),'plot');
set(get(AX(1),'Ylabel'),'String','cart position (m)')
set(get(AX(2),'Ylabel'),'String','pendulum angle (radians)')
title('Step Response with LQR Control')

```

![](https://ws1.sinaimg.cn/large/006tNbRwgy1fxkan1mmf2j30v40nct9q.jpg)
Simscapeä»¿çœŸ:
![](https://ws2.sinaimg.cn/large/006tNbRwgy1fxkaxaoa59j30v40m0jsl.jpg)
![](https://ws2.sinaimg.cn/large/006tNbRwgy1fxkb065i5xg30i008emzk.gif)

æ”¹å˜$$R$$å’Œ$$Q$$èƒ½å¾—åˆ°ä¸åŒçš„æ•ˆæœ.

